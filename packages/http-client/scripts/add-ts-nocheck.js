/**
 * @fileoverview Post-generation script to add @ts-nocheck to generated files.
 *
 * This script runs after heyAPI generates the client files.
 * It adds `// @ts-nocheck` to the top of generated .ts files to prevent
 * TypeScript errors from the generated code (e.g., duplicate Content-Type headers).
 *
 * Usage: Called automatically by `pnpm generate`
 */
import { readdir, readFile, writeFile } from 'node:fs/promises'
import { join } from 'node:path'
import { fileURLToPath } from 'node:url'

const __dirname = fileURLToPath(new URL('.', import.meta.url))
const clientDir = join(__dirname, '..', 'src', 'client')

const TS_NOCHECK = '// @ts-nocheck\n'

async function addTsNocheck() {
  try {
    const files = await readdir(clientDir)
    const tsFiles = files.filter((f) => f.endsWith('.ts'))

    for (const file of tsFiles) {
      const filePath = join(clientDir, file)
      const content = await readFile(filePath, 'utf-8')

      // Skip if already has @ts-nocheck
      if (content.startsWith('// @ts-nocheck')) {
        continue
      }

      // Add @ts-nocheck after the auto-generated comment
      const newContent = content.replace(
        '// This file is auto-generated by @hey-api/openapi-ts',
        '// This file is auto-generated by @hey-api/openapi-ts\n// @ts-nocheck'
      )

      await writeFile(filePath, newContent, 'utf-8')
      console.log(`Added @ts-nocheck to ${file}`)
    }

    console.log('Done!')
  } catch (error) {
    console.error('Error adding @ts-nocheck:', error)
    process.exit(1)
  }
}

addTsNocheck()
